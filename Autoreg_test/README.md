# Исследование эффективности однонедельного прогноза спроса компании ВсеИнструмены.ру

## Задача

В данном ноутбуке решается задача прогнозирования трехнедельного, а также недельного спроса на __сезонные товары__ конкретных поставщиков.

В предыдущих фазах исследования эмпирическим путем было утсановлено:

- Удобно использовать пакет Darts
- Ridge-регрессия  дает оптимальные по соотношению качество-скорость результаты
- При этом регрессию лучше применять не к отдельным товарам, а к представителям некоторых кластеров
- В качестве кластеров естественно были взяты подрубрики товаров (rubr_lev2)
- В качестве признаков регресии лучше всего использовать исключительно прошлые лаги самого представителя. Никакие сезонные ковариаты оказались не нужны
- Самих представителей определяем беря сумму по всем товарам кластера и деля ее на логарифм кол-ва товаров на каждую дату
- Выгодно отбросить нерегулярности представителя, применив алгоритм STL из пакета statsmodels.
- Также выгодно "сдвинуть прогноз влево". Это означает, что модель линейной регрессии обучается на одних лагах, а вот прогноз строится с теми же лагами, сдвинутыми на 2 недели вперед. Это необходимо, чтобы опережающим образом создавать запас товара при растущем тренде, а также держать малое кол-во товара при нисходящем.
- Получив прогноз представителя, рассчитываем градиент, т.е. отношение 3-недели вперед/три недели назад, и применяем этот градиент к каждому товарному ряду, чтобы получить прогноз.

В данном ноутбуке дополнительно тестируется __однонедельный прогноз__, а именно
- прогнозируем три недели, затем берем среднее
- сразу прогнозируем одну неделю

Кроме того к окончательному прогнозу мы добавляем расчеты __страховых запасов__. 

Нужно заметить, что поскольку мы делаем "левый сдвиг" прогноза, формальные метрики, например mae или mape, получаются хуже, чем без сдвига. Это можно объяснить тем, что мы перезапасаем товар на растущем тренде, и недозапасаем при нисходящем. В связи с этим, разумно оценивать наши результаты не только по метрикам, но и зрительно анализируя графики прогноза и реального спроса.

## Основные используемые библиотеки

*pandas*,*darts*, *matplotlib*, *numpy*, *scipy.stats*, *sklearn*, *statsmodels*|

## Вывод

- Протестировали два подхода к расчету представителей. Оказалось, что лучше делать STL трансформацию.

- Для недельного прогноза оказалось, что лучше сначала делать прогноз на три недели вперед, а затем усреднять его.

- Добавили к недельному прогнозу расчеты стразовых запасов на базе дневных исторических данных.




